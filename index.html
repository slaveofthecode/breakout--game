<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Breakout Game Js</title>

		<style>
			canvas {
				background-color: #f4f4f4;
				margin: 10% auto;
				display: block;
			}
		</style>
	</head>
	<body>
		<canvas width="480" height="240" />
	</body>

	<script>
		const canvas = document.querySelector("canvas");
		const ctx = canvas.getContext("2d");

		const velocity = 2;
		const mov = {
			x: velocity,
			y: -velocity,
		};
		const ball = {
			radius: 5,
			color: "red",
		};
		const paddle = {
			height: 10,
			width: 75,
			color: "green",
		};

		const brick = {
			height: 16,
			width: 48,
			color: "#888",
			offsetTop: 20,
			offsetLeft: canvas.width / 2 - (48 * 6) / 2 - 8,
			padding: 8,
		};

		const rowBricks = 3;
		const colBricks = 6;
		const bricks = [];

		for (let r = 0; r < rowBricks; r++) {
			bricks[r] = [];
			for (let c = 0; c < colBricks; c++) {
				const posX =
					c * (brick.width + brick.padding) + brick.offsetLeft;
				const posY =
					r * (brick.height + brick.padding) + brick.offsetTop;
				bricks[r][c] = {
					posX,
					posY,
					status: 1,
				};
			}
		}

		console.log("BRICKS", bricks);

		const position = {
			ball: {
				x: canvas.width / 2,
				y: canvas.height - ball.radius - paddle.height - 2,
			},
			paddle: {
				x: canvas.width / 2 - paddle.width / 5,
				y: canvas.height - paddle.height,
			},
		};

		let keyRightPressed = false;
		let keyLeftPressed = false;

		function drawBall() {
			ctx.beginPath();
			ctx.arc(
				position.ball.x,
				position.ball.y,
				ball.radius,
				0,
				Math.PI * 2
			);
			ctx.fillStyle = ball.color;
			ctx.fill();
			ctx.closePath();
		}

		function drawPaddle() {
			ctx.beginPath();
			ctx.rect(
				position.paddle.x,
				position.paddle.y,
				paddle.width,
				paddle.height
			);
			ctx.fillStyle = paddle.color;
			ctx.fill();
			ctx.closePath();
		}

		function moveBall() {
			const isRightWall = position.ball.x + ball.radius > canvas.width;
			const isTopWall = position.ball.y - ball.radius < 0;
			const isLeftWall = position.ball.x - ball.radius < 0;
			const isBottomWall = position.ball.y > canvas.height;
			const isPaddle =
				position.ball.y + ball.radius > position.paddle.y &&
				position.ball.x > position.paddle.x + ball.radius &&
				position.ball.x < position.paddle.x + paddle.width;

			if (isRightWall) {
				mov.x = -velocity;
			} else if (isTopWall) {
				mov.y = velocity;
			} else if (isLeftWall) {
				mov.x = velocity;
			} else if (isPaddle) {
				mov.y = -velocity;
			} else if (isBottomWall) {
				console.log("Game Over");
				document.location.reload();
			}

			for (let r = 0; r < rowBricks; r++) {
				for (let c = 0; c < colBricks; c++) {
					const currentBrick = bricks[r][c];
					if (currentBrick.status === 1) {
						if (
							position.ball.x > currentBrick.posX &&
							position.ball.x < currentBrick.posX + brick.width &&
							position.ball.y > currentBrick.posY &&
							position.ball.y < currentBrick.posY + brick.height
						) {
							mov.y = -mov.y;
							currentBrick.status = 0;
						}
					}
				}
			}

			position.ball.x += mov.x;
			position.ball.y += mov.y;
		}

		function movePaddle() {
			const isLeftWall = position.paddle.x < 0;
			const isRightWall = position.paddle.x + paddle.width > canvas.width;

			if (keyRightPressed && !isRightWall) {
				position.paddle.x += velocity * 2;
			} else if (keyLeftPressed && !isLeftWall) {
				position.paddle.x -= velocity * 2;
			}
		}

		function drawBricks() {
			for (let r = 0; r < rowBricks; r++) {
				for (let c = 0; c < colBricks; c++) {
					const currentBrinck = bricks[r][c];

					if (currentBrinck.status === 0) continue;

					ctx.beginPath();
					ctx.rect(
						currentBrinck.posX,
						currentBrinck.posY,
						brick.width,
						brick.height
					);
					ctx.fillStyle = brick.color;
					ctx.fill();
					ctx.closePath();
				}
			}
		}

		function cleanCtx() {
			ctx.clearRect(0, 0, canvas.width, canvas.height);
		}

		function initEventsListeners() {
			document.addEventListener("keydown", keyDownHandler, false);
			document.addEventListener("keyup", keyUpHandler, false);

			function keyDownHandler(e) {
				if (e.key === "Right" || e.key === "ArrowRight") {
					keyRightPressed = true;
				} else if (e.key === "Left" || e.key === "ArrowLeft") {
					keyLeftPressed = true;
				}
			}

			function keyUpHandler(e) {
				if (e.key === "Right" || e.key === "ArrowRight") {
					keyRightPressed = false;
				} else if (e.key === "Left" || e.key === "ArrowLeft") {
					keyLeftPressed = false;
				}
			}
		}

		function play() {
			cleanCtx();
			// window.requestAnimationFrame(play);
			drawBall();
			drawPaddle();
			moveBall();
			movePaddle();

			drawBricks();
		}

		play();
		initEventsListeners();
	</script>
</html>
